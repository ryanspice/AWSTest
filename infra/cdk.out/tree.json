{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.222.0"},"children":{"WebStack":{"id":"WebStack","path":"WebStack","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.222.0"},"children":{"SiteBucket":{"id":"SiteBucket","path":"WebStack/SiteBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"WebStack/SiteBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"ownershipControls":{"rules":[{"objectOwnership":"BucketOwnerEnforced"}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true}}}},"Policy":{"id":"Policy","path":"WebStack/SiteBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"WebStack/SiteBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"SiteBucket397A1860"},"policyDocument":{"Statement":[{"Action":"s3:GetObject","Condition":{"StringEquals":{"AWS:SourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":cloudfront::",{"Ref":"AWS::AccountId"},":distribution/",{"Ref":"WebDist5713AA0A"}]]}}},"Effect":"Allow","Principal":{"Service":"cloudfront.amazonaws.com"},"Resource":{"Fn::Join":["",[{"Fn::GetAtt":["SiteBucket397A1860","Arn"]},"/*"]]}}],"Version":"2012-10-17"}}}}}}}},"ApiFn":{"id":"ApiFn","path":"WebStack/ApiFn","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.222.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"WebStack/ApiFn/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.222.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"WebStack/ApiFn/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.222.0","metadata":[]}},"Resource":{"id":"Resource","path":"WebStack/ApiFn/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}}}},"Resource":{"id":"Resource","path":"WebStack/ApiFn/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\n    exports.handler = async function (event) {\n      const rawPath  = event?.rawPath || '/';\n      const method   = event?.requestContext?.http?.method || 'GET';\n\n      if (rawPath.endsWith('/ping') && method === 'GET') {\n        return json(200, {\n          ok: true,\n          method,\n          path: rawPath,\n          ts: Date.now(),\n          region: process.env.AWS_REGION,\n          functionName: process.env.AWS_LAMBDA_FUNCTION_NAME,\n          memory: Number(process.env.AWS_LAMBDA_FUNCTION_MEMORY_SIZE || 0)\n        });\n      }\n\n      if (rawPath.endsWith('/echo') && method === 'POST') {\n        let parsed = null;\n        try { parsed = event?.body ? JSON.parse(event.body) : null; } catch {}\n        return json(200, {\n          ok: true,\n          method,\n          path: rawPath,\n          ts: Date.now(),\n          region: process.env.AWS_REGION,\n          functionName: process.env.AWS_LAMBDA_FUNCTION_NAME,\n          memory: Number(process.env.AWS_LAMBDA_FUNCTION_MEMORY_SIZE || 0),\n          echo: parsed\n        });\n      }\n\n      return json(404, { ok: false, error: 'not found', path: rawPath, method });\n    };\n\n    function json(status, obj) {\n      return {\n        statusCode: status,\n        headers: {\n          'content-type': 'application/json',\n          'access-control-allow-origin': '*',\n          'cache-control': 'no-store'\n        },\n        body: JSON.stringify(obj)\n      };\n    }\n  "},"handler":"index.handler","memorySize":128,"role":{"Fn::GetAtt":["ApiFnServiceRoleD18AAE0E","Arn"]},"runtime":"nodejs20.x","timeout":5}}},"LogRetention":{"id":"LogRetention","path":"WebStack/ApiFn/LogRetention","constructInfo":{"fqn":"aws-cdk-lib.aws_logs.LogRetention","version":"2.222.0"},"children":{"Resource":{"id":"Resource","path":"WebStack/ApiFn/LogRetention/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.222.0"}}}},"LogGroup":{"id":"LogGroup","path":"WebStack/ApiFn/LogGroup","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.222.0","metadata":[]}}}},"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a":{"id":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Code":{"id":"Code","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code","constructInfo":{"fqn":"aws-cdk-lib.aws_s3_assets.Asset","version":"2.222.0"},"children":{"Stage":{"id":"Stage","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/Stage","constructInfo":{"fqn":"aws-cdk-lib.AssetStaging","version":"2.222.0"}},"AssetBucket":{"id":"AssetBucket","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Code/AssetBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketBase","version":"2.222.0","metadata":[]}}}},"ServiceRole":{"id":"ServiceRole","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.222.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.222.0","metadata":[]}},"Resource":{"id":"Resource","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["logs:PutRetentionPolicy","logs:DeleteRetentionPolicy"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB","roles":[{"Ref":"LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB"}]}}}}}}},"Resource":{"id":"Resource","path":"WebStack/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.222.0"}}}},"HttpApi":{"id":"HttpApi","path":"WebStack/HttpApi","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpApi","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"WebStack/HttpApi/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnApi","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Api","aws:cdk:cloudformation:props":{"corsConfiguration":{"allowHeaders":["*"],"allowMethods":["*"],"allowOrigins":["*"]},"name":"HttpApi","protocolType":"HTTP"}}},"DefaultStage":{"id":"DefaultStage","path":"WebStack/HttpApi/DefaultStage","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpStage","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"WebStack/HttpApi/DefaultStage/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnStage","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Stage","aws:cdk:cloudformation:props":{"apiId":{"Ref":"HttpApiF5A9A8A7"},"autoDeploy":true,"stageName":"$default"}}}}},"ANY--api--{proxy+}":{"id":"ANY--api--{proxy+}","path":"WebStack/HttpApi/ANY--api--{proxy+}","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpRoute","version":"2.222.0","metadata":[]},"children":{"ApiInt":{"id":"ApiInt","path":"WebStack/HttpApi/ANY--api--{proxy+}/ApiInt","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpIntegration","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"WebStack/HttpApi/ANY--api--{proxy+}/ApiInt/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"HttpApiF5A9A8A7"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::GetAtt":["ApiFnE0725F78","Arn"]},"payloadFormatVersion":"2.0"}}}}},"ApiInt-Permission":{"id":"ApiInt-Permission","path":"WebStack/HttpApi/ANY--api--{proxy+}/ApiInt-Permission","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["ApiFnE0725F78","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":execute-api:ca-central-1:485527056249:",{"Ref":"HttpApiF5A9A8A7"},"/*/*/api/{proxy+}"]]}}}},"Resource":{"id":"Resource","path":"WebStack/HttpApi/ANY--api--{proxy+}/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"HttpApiF5A9A8A7"},"authorizationType":"NONE","routeKey":"ANY /api/{proxy+}","target":{"Fn::Join":["",["integrations/",{"Ref":"HttpApiANYapiproxyApiInt068E0BF1"}]]}}}}}}}},"WebDist":{"id":"WebDist","path":"WebStack/WebDist","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.Distribution","version":"2.222.0","metadata":[]},"children":{"Origin1":{"id":"Origin1","path":"WebStack/WebDist/Origin1","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"S3OriginAccessControl":{"id":"S3OriginAccessControl","path":"WebStack/WebDist/Origin1/S3OriginAccessControl","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.S3OriginAccessControl","version":"2.222.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"WebStack/WebDist/Origin1/S3OriginAccessControl/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnOriginAccessControl","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::OriginAccessControl","aws:cdk:cloudformation:props":{"originAccessControlConfig":{"name":"WebStackWebDistOrigin1S3OriginAccessControlF59622AD","signingBehavior":"always","signingProtocol":"sigv4","originAccessControlOriginType":"s3"}}}}}}}},"Origin2":{"id":"Origin2","path":"WebStack/WebDist/Origin2","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}},"Resource":{"id":"Resource","path":"WebStack/WebDist/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_cloudfront.CfnDistribution","version":"2.222.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::CloudFront::Distribution","aws:cdk:cloudformation:props":{"distributionConfig":{"enabled":true,"origins":[{"domainName":{"Fn::GetAtt":["SiteBucket397A1860","RegionalDomainName"]},"id":"WebStackWebDistOrigin1B12A1AE1","s3OriginConfig":{"originAccessIdentity":""},"originAccessControlId":{"Fn::GetAtt":["WebDistOrigin1S3OriginAccessControl5181ED8A","Id"]}},{"domainName":{"Fn::Join":["",[{"Ref":"HttpApiF5A9A8A7"},".execute-api.ca-central-1.amazonaws.com"]]},"id":"WebStackWebDistOrigin240220D46","customOriginConfig":{"originSslProtocols":["TLSv1.2"],"originProtocolPolicy":"https-only"}}],"defaultCacheBehavior":{"pathPattern":"*","targetOriginId":"WebStackWebDistOrigin1B12A1AE1","allowedMethods":["GET","HEAD","OPTIONS"],"cachePolicyId":"658327ea-f89d-4fab-a63d-7e88639e58f6","compress":true,"responseHeadersPolicyId":"67f7725c-6f97-4210-82d7-5512b31e9d03","viewerProtocolPolicy":"redirect-to-https"},"cacheBehaviors":[{"pathPattern":"api/*","targetOriginId":"WebStackWebDistOrigin240220D46","allowedMethods":["GET","HEAD","OPTIONS","PUT","PATCH","POST","DELETE"],"cachePolicyId":"4135ea2d-6df8-44a3-9df3-4b5a84be39ad","compress":true,"originRequestPolicyId":"b689b0a8-53d0-40ab-baf2-68738e2966ac","viewerProtocolPolicy":"redirect-to-https"}],"customErrorResponses":[{"errorCachingMinTtl":0,"errorCode":403,"responseCode":200,"responsePagePath":"/index.html"},{"errorCachingMinTtl":0,"errorCode":404,"responseCode":200,"responsePagePath":"/index.html"}],"defaultRootObject":"index.html","httpVersion":"http2","ipv6Enabled":true}}}}}},"BucketName":{"id":"BucketName","path":"WebStack/BucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.222.0"}},"DistributionId":{"id":"DistributionId","path":"WebStack/DistributionId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.222.0"}},"DistributionDomain":{"id":"DistributionDomain","path":"WebStack/DistributionDomain","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.222.0"}},"ApiBaseUrl":{"id":"ApiBaseUrl","path":"WebStack/ApiBaseUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.222.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"WebStack/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"WebStack/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.222.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"WebStack/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.222.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"WebStack/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.222.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}